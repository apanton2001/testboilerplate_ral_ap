# Automated Customs Documentation Platform

A web-based platform that helps importers generate accurate customs documentation efficiently.

## Project Overview

This platform automates the process of generating customs documentation by:
- Managing invoice data via an intuitive interface.
- Automatically classifying goods with HS codes using AI (ContextGem).
- Providing a review workflow for flagged classifications.
- Generating customs-compliant documents (XML, PDF).
- Submitting documentation to customs systems (e.g., ASYCUDA).
- Integrating with accounting (QuickBooks) and freight-forwarding systems.
- Offering reporting and analytics on volume, accuracy, and savings.
- Ensuring robust security, error handling, and performance.

## Tech Stack

### Frontend
- React 18.2.0
- Next.js 14.0.0
- AG Grid 29.0.0
- Tailwind CSS 3.3.0
- NextAuth.js 4.22.0
- TypeScript

### Backend
- Node.js 20.2.1
- Express 4.18.2
- PostgreSQL 15.0 (with Sequelize ORM)
- Redis 7.0 (for caching)
- Helmet (Security Headers)
- Express Rate Limit (Rate Limiting)
- CORS (Cross-Origin Resource Sharing)
- Winston (Logging)
- Swagger-UI-Express & Swagger-JSDoc (API Documentation)
- xmlbuilder2 3.0.2
- Puppeteer 19.7.1 (Potentially for PDF generation)
- Axios (HTTP Client)
- Express-validator (Input Validation)

## Project Structure

```
/
├── frontend/             # Next.js frontend application
│   ├── components/       # Reusable React components (incl. ErrorBoundary)
│   ├── pages/            # Next.js pages (incl. _app, _document, 404, 500)
│   ├── public/           # Static assets
│   ├── styles/           # CSS styles (Tailwind)
│   ├── utils/            # Utility functions
│   └── next.config.js    # Next.js configuration (incl. CSP headers)
│
├── backend/              # Node.js/Express backend application
│   ├── src/
│   │   ├── config/       # Configuration files (db, etc.)
│   │   ├── middleware/   # Express middleware (auth, validation, errors, security)
│   │   ├── models/       # Sequelize data models
│   │   ├── routes/       # API routes (with Swagger JSDoc)
│   │   ├── services/     # Business logic (classification, integrations, etc.)
│   │   └── utils/        # Utility functions
│   ├── database/
│   │   └── schema.sql    # Database schema with indexes
│   ├── logs/             # Log files (generated by Winston)
│   └── .env.example      # Environment variables template
│
├── document/             # Project documentation (architecture, guides, etc.)
│
└── .github/              # GitHub Actions workflows
    └── workflows/
        ├── backend.yml
        └── frontend.yml
```

## Getting Started

### Prerequisites
- Node.js (v20.2.1 or higher)
- PostgreSQL (v15.0 or higher)
- Redis (v7.0 or higher)
- Git

### Installation

1.  **Clone the repository**
    ```bash
    git clone <repository-url>
    cd automated-customs-documentation
    ```

2.  **Install Frontend Dependencies**
    ```bash
    cd frontend
    npm install
    ```

3.  **Install Backend Dependencies**
    ```bash
    cd ../backend
    npm install
    ```

4.  **Set up Environment Variables**
    - Copy `.env.example` to `.env` in the `backend` directory.
    - Edit `.env` with your database credentials, API keys (ContextGem, Stripe, etc.), JWT secret, Redis URL, frontend URL, and other configurations.
    - Optionally create `.env.local` in the `frontend` directory to override `NEXT_PUBLIC_API_URL` for local development.

5.  **Database Setup**
    - Ensure your PostgreSQL server is running.
    - Create the database specified in your `backend/.env` file.
    - Apply the schema:
      ```bash
      psql -U <your_db_user> -d <your_db_name> -a -f backend/database/schema.sql
      ```
    - Run seed scripts (optional but recommended):
      ```bash
      cd backend
      node src/scripts/seedRoles.js
      # node src/scripts/createAdminUser.js # If needed
      cd ..
      ```

6.  **Start the Development Servers**

    *   **Backend:**
        ```bash
        cd backend
        npm run dev
        ```
        (The backend server typically runs on port 5000)

    *   **Frontend:**
        ```bash
        cd ../frontend
        npm run dev
        ```
        (The frontend server typically runs on port 3000)

7.  **Access the Application**
    - Open your browser and navigate to `http://localhost:3000`.

## Features

-   **User Authentication:** Secure login with JWT and role-based access control (Admin, Reviewer, Clerk).
-   **Invoice Management:** Create, view, edit, and delete invoices using an Excel-like grid interface (AG Grid).
-   **Automated Classification:** AI-powered HS code suggestions for invoice line items via ContextGem API.
-   **Review Workflow:** Flagging mechanism for uncertain classifications, allowing reviewers to approve or adjust HS codes.
-   **Document Generation:** Create customs-compliant documents (initial setup for XML/PDF).
-   **Customs Submission:** Submit generated documents to customs systems (placeholder/integration points).
-   **Integrations:**
    -   QuickBooks: Sync invoices.
    -   Freight Forwarders: Connect and track shipments (extensible).
    -   Stripe: Manage user subscriptions.
-   **Notifications:** In-app and email notifications for key events.
-   **Reporting & Analytics:** Generate reports on import volume, classification accuracy, and cost savings.
-   **Security:** Includes Helmet security headers, Content Security Policy (CSP), rate limiting, CORS configuration, and input validation/sanitization.
-   **Error Handling:** Centralized backend error handling, structured logging, frontend error boundaries, and custom error pages (404, 500).
-   **Performance:** Redis caching for classifications, database indexing, API response compression, and frontend code splitting/lazy loading.

## Security

The platform incorporates several security measures:

-   **Backend Security Headers:** Uses `helmet` middleware to set various HTTP headers (Strict-Transport-Security, X-Frame-Options, X-Content-Type-Options, etc.) to protect against common web vulnerabilities.
-   **Content Security Policy (CSP):** Configured in `frontend/next.config.js` to restrict the sources from which content (scripts, styles, images) can be loaded, mitigating XSS attacks.
-   **Rate Limiting:** Implemented using `express-rate-limit` on sensitive backend routes (e.g., login, API endpoints) to prevent brute-force attacks.
-   **CORS Configuration:** Properly configured Cross-Origin Resource Sharing in the backend (`cors` middleware) to control which frontend origins can access the API.
-   **Input Validation & Sanitization:** Uses `express-validator` on all backend API routes to validate incoming data types, formats, and lengths, and to sanitize inputs against XSS and injection attacks.
-   **Authentication & Authorization:** Secure JWT-based authentication and role-based authorization middleware protect API endpoints.
-   **HTTPS:** Assumed for deployment (enforced via Strict-Transport-Security).
-   **Secrets Management:** Relies on environment variables (`.env`) for sensitive keys and credentials, which should not be committed to version control.

*(Refer to `document/security_guideline_document.md` for more details)*

## Error Handling & Logging

-   **Backend:**
    -   **Centralized Error Handling:** A dedicated error handling middleware in `backend/src/middleware/errorHandler.js` catches errors propagated via `next(error)` from routes and services.
    -   **Structured Logging:** Uses `winston` for structured JSON logging to both the console and log files (`backend/logs/`). Logs include timestamps, severity levels, service context, and error details.
-   **Frontend:**
    -   **Global Error Boundary:** `frontend/components/ErrorBoundary.tsx` wraps the entire application in `_app.tsx` to catch React rendering errors and display a user-friendly fallback UI.
    -   **Custom Error Pages:** `frontend/pages/404.tsx` and `frontend/pages/500.tsx` provide user-friendly messages for page-not-found and server-side errors, respectively.

## Performance Optimizations

-   **Backend Caching:** Uses Redis (`redis` client) to cache results from expensive operations like the ContextGem classification API (`backend/src/services/classificationService.js`).
-   **Database Indexing:** Added indexes to frequently queried columns in `backend/database/schema.sql` (e.g., foreign keys, status fields, user IDs) to improve database query performance.
-   **API Response Compression:** Uses `compression` middleware in the backend (`backend/src/index.js`) to gzip API responses, reducing bandwidth usage and speeding up data transfer.
-   **Frontend Code Splitting:** Leverages Next.js automatic code splitting by page.
-   **Frontend Lazy Loading:** Implemented `next/dynamic` for component-level lazy loading (e.g., `Navbar`, `AnalyticsDashboard` in `frontend/pages/dashboard.tsx`) to improve initial page load times by deferring the loading of non-critical components.

## API Documentation

API documentation is generated using Swagger.

-   **Swagger JSDoc:** Annotations (`@swagger`) are added directly in the backend route files (`backend/src/routes/*.js`).
-   **Swagger UI:** The API specification is served interactively via Swagger UI at the `/api-docs` endpoint in the backend (configured in `backend/src/index.js`).

To view the API documentation, run the backend server and navigate to `http://localhost:5000/api-docs` (or the appropriate host/port).

## User Guides

*(Placeholder: Links to user guides for different roles will be added here.)*

-   [Admin Guide](./document/user_guide_admin.md)
-   [Reviewer Guide](./document/user_guide_reviewer.md)
-   [Clerk Guide](./document/user_guide_clerk.md)

## Deployment

*(Existing Deployment section remains largely the same, but ensure environment variables mentioned align with `.env.example`)*

### Frontend Deployment (Vercel)
... (content as before) ...

### Backend Deployment (AWS Elastic Beanstalk)
... (content as before, ensure DB setup mentions applying schema/indexes) ...

## CI/CD Pipeline

*(Existing CI/CD section remains the same)*
... (content as before) ...

## Testing

*(Existing Testing section remains the same)*
... (content as before) ...

## License

[MIT](LICENSE)